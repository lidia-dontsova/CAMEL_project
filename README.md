# CAMEL Эксперимент

Экспериментальный проект для оценки производительности языковых моделей в различных задачах с использованием фреймворка CAMEL (Communicative Agents for "Mind" Exploration of Large Language Model Society).

## Описание

Проект реализует систему двух агентов (Coder и Reviewer), которые взаимодействуют для решения задач на различные тематики. Каждое решение оценивается LLM-судьей, который классифицирует результат и присваивает оценку релевантности (1-10).

### Основные возможности

- **5 тематик × 3 задачи** - разнообразный набор задач для тестирования
- **Обязательный судья** - автоматическая оценка решений с классификацией и числовой оценкой
- **Метрики** - flake_ratio, completion_rate, time_per_round
- **Логирование в JSONL** - сохранение всех результатов экспериментов
- **Резюмирование решений** - автоматическое извлечение финального решения из диалога
- **Маркер завершения** - поддержка `<CAMEL_TASK_DONE>` для остановки диалога

## Структура проекта

```
CAMEL_project/
├── main.py                 # Основной файл с логикой эксперимента
├── requirements.txt        # Зависимости проекта
├── README.md              # Документация проекта
├── PLAN.md                # План проекта
├── logs/                  # Директория с логами
│   └── dialogs.jsonl      # JSONL файл с результатами экспериментов
└── .gitignore            # Игнорируемые файлы
```

## Технологии

- **Python 3.11+** - основной язык программирования
- **CAMEL-AI** - фреймворк для создания коммуникативных агентов
- **OpenAI API** - для работы с языковыми моделями (gpt-4o-mini, gpt-3.5-turbo, gpt-3.5-turbo-0125)
- **JSONL** - формат логирования результатов

## Требования

### Системные требования

- Python 3.11 или выше
- Доступ к OpenAI API (API ключ)

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Переменные окружения

Необходимо установить API ключ OpenAI:

```bash
export OPENAI_API_KEY="your-api-key-here"
```

## Использование

### Запуск

```bash
python main.py
```

Программа автоматически выполнит все задачи из всех тематик для всех указанных моделей.

### Темы задач

1. **Programming** - задачи программирования
   - Реализация функции для вычисления чисел Фибоначчи
   - Удаление дублирующихся строк из файла
   - Проектирование REST API для регистрации и аутентификации

2. **Language** - лингвистические задачи
   - Объяснение идиомы "break the ice"
   - Перевод с сохранением стиля
   - Объяснение пресуппозиции в семантике

3. **Math_Logic** - математические и логические задачи
   - Решение системы уравнений
   - Логические выводы
   - Вычисление производных

4. **STEM_Explanation** - объяснения STEM-концепций
   - Как обучаются нейронные сети
   - Как работают солнечные панели
   - Архитектура автономного вождения

5. **Role_Playing** - ролевые сценарии
   - Врач объясняет диагноз пациенту
   - HR-рекрутер проводит собеседование
   - Переговоры между покупателем и продавцом

### Тестируемые модели

- `gpt-4o-mini` 
- `gpt-3.5-turbo` 
- `gpt-3.5-turbo-0125` 

## Метрики

Проект собирает следующие метрики для каждого эксперимента:

- **turns** - количество ходов в диалоге
- **flake_ratio** - отношение нечетких/заполнительных фраз к общему количеству ходов
- **avg_msg_len** - средняя длина сообщения
- **completion_rate** - показатель завершения задачи (1.0 если задача завершена, 0.0 иначе)
- **time_per_round** - среднее время на раунд (секунды)
- **judge_verdict** - вердикт судьи (SUCCESS/PARTIAL/FAIL)
- **relevance_score** - оценка релевантности решения (1-10)
- **success_flag** - флаг успешности (true/false)

## Результаты

### Формат логов

Результаты сохраняются в `logs/dialogs.jsonl` в формате JSON Lines. Каждая строка содержит:

```json
{
  "id": "uuid",
  "timestamp": "ISO timestamp",
  "assistant_model": "model_name",
  "user_model": "model_name",
  "task": "task description",
  "rounds": 8,
  "domain": "domain_name",
  "metrics": {
    "turns": 11,
    "flake_ratio": 0.0,
    "avg_msg_len": 1340.5,
    "completion_rate": 1.0,
    "time_per_round": 8.727,
    "judge_verdict": "SUCCESS",
    "relevance_score": 10.0,
    "success_flag": true
  },
  "final": "final solution text",
  "dialog": [...]
}
```


## Особенности реализации

### Маркер завершения задачи

Агенты могут использовать маркер `<CAMEL_TASK_DONE>` для сигнализации о завершении задачи. При обнаружении маркера диалог автоматически останавливается, и извлекается финальное решение.

### Резюмирование решений

Финальное решение автоматически резюмируется из всего диалога с помощью LLM, извлекая только ключевые части решения и удаляя промежуточные обсуждения.


## Авторы

Лидия Донцова, Полина Гумерова

